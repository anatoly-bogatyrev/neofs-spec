<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="635px" preserveAspectRatio="none" style="width:788px;height:635px;" version="1.1" viewBox="0 0 788 635" width="788px" zoomAndPan="magnify"><defs><filter height="300%" id="fvbd0nvg5i745" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fvbd0nvg5i745)" height="189.6641" style="stroke: #000000; stroke-width: 2.0;" width="489" x="13" y="100.7266"/><rect fill="#FFFFFF" filter="url(#fvbd0nvg5i745)" height="103.3984" style="stroke: #000000; stroke-width: 2.0;" width="531" x="238" y="304.3906"/><rect fill="#FFFFFF" filter="url(#fvbd0nvg5i745)" height="103.3984" style="stroke: #000000; stroke-width: 2.0;" width="375" x="394" y="421.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="59" y1="54.5938" y2="176.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="59" x2="59" y1="176.125" y2="204.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="59" y1="204.125" y2="262.3906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="59" x2="59" y1="262.3906" y2="290.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="59" y1="290.3906" y2="379.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="59" x2="59" y1="379.7891" y2="407.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="59" y1="407.7891" y2="497.1875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="59" x2="59" y1="497.1875" y2="525.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="59" x2="59" y1="525.1875" y2="571.3203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="171" x2="171" y1="54.5938" y2="176.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="171" x2="171" y1="176.125" y2="204.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="171" x2="171" y1="204.125" y2="262.3906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="171" x2="171" y1="262.3906" y2="290.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="171" x2="171" y1="290.3906" y2="379.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="171" x2="171" y1="379.7891" y2="407.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="171" x2="171" y1="407.7891" y2="497.1875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="171" x2="171" y1="497.1875" y2="525.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="171" x2="171" y1="525.1875" y2="571.3203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="321" x2="321" y1="54.5938" y2="176.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="321" x2="321" y1="176.125" y2="204.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="321" x2="321" y1="204.125" y2="262.3906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="321" x2="321" y1="262.3906" y2="290.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="321" x2="321" y1="290.3906" y2="379.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="321" x2="321" y1="379.7891" y2="407.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="321" x2="321" y1="407.7891" y2="497.1875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="321" x2="321" y1="497.1875" y2="525.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="321" x2="321" y1="525.1875" y2="571.3203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448" x2="448" y1="54.5938" y2="176.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="448" x2="448" y1="176.125" y2="204.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448" x2="448" y1="204.125" y2="262.3906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="448" x2="448" y1="262.3906" y2="290.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448" x2="448" y1="290.3906" y2="379.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="448" x2="448" y1="379.7891" y2="407.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448" x2="448" y1="407.7891" y2="497.1875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="448" x2="448" y1="497.1875" y2="525.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448" x2="448" y1="525.1875" y2="571.3203"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="692" y1="54.5938" y2="176.125"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="692" x2="692" y1="176.125" y2="204.125"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="692" y1="204.125" y2="262.3906"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="692" x2="692" y1="262.3906" y2="290.3906"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="692" y1="290.3906" y2="379.7891"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="692" x2="692" y1="379.7891" y2="407.7891"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="692" y1="407.7891" y2="497.1875"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="692" x2="692" y1="497.1875" y2="525.1875"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="692" y1="525.1875" y2="571.3203"/><rect fill="#FEFECE" filter="url(#fvbd0nvg5i745)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="23" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="30" y="22.9951">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="35" y="39.292">nodes</text><rect fill="#FEFECE" filter="url(#fvbd0nvg5i745)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="68" x="23" y="570.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="54" x="30" y="590.3154">Storage</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="44" x="35" y="606.6123">nodes</text><rect fill="#FEFECE" filter="url(#fvbd0nvg5i745)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="105" y="19.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="112" y="39.292">Netmap contract</text><rect fill="#FEFECE" filter="url(#fvbd0nvg5i745)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="129" x="105" y="570.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="115" x="112" y="590.3154">Netmap contract</text><rect fill="#FEFECE" filter="url(#fvbd0nvg5i745)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="248" y="19.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="255" y="39.292">Container contract</text><rect fill="#FEFECE" filter="url(#fvbd0nvg5i745)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="142" x="248" y="570.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="128" x="255" y="590.3154">Container contract</text><rect fill="#FEFECE" filter="url(#fvbd0nvg5i745)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="404" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="411" y="22.9951">Inner Ring</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="423.5" y="39.292">Nodes</text><rect fill="#FEFECE" filter="url(#fvbd0nvg5i745)" height="46.5938" style="stroke: #A80036; stroke-width: 1.5;" width="84" x="404" y="570.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="70" x="411" y="590.3154">Inner Ring</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="45" x="423.5" y="606.6123">Nodes</text><rect fill="#FEFECE" filter="url(#fvbd0nvg5i745)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="625" y="19.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="632" y="39.292">Balance contract</text><rect fill="#FEFECE" filter="url(#fvbd0nvg5i745)" height="30.2969" style="stroke: #A80036; stroke-width: 1.5;" width="130" x="625" y="570.3203"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="632" y="590.3154">Balance contract</text><polygon fill="#A80036" points="436,81.7266,446,85.7266,436,89.7266,440,85.7266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="171.5" x2="442" y1="85.7266" y2="85.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="178.5" y="80.6606">New epoch notification</text><path d="M13,100.7266 L151,100.7266 L151,107.7266 L141,117.7266 L13,117.7266 L13,100.7266 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="189.6641" style="stroke: #000000; stroke-width: 2.0;" width="489" x="13" y="100.7266"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="28" y="113.7935">1\3 of epoch</text><polygon fill="#A80036" points="332,134.9922,322,138.9922,332,142.9922,328,138.9922" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="326" x2="447" y1="138.9922" y2="138.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="338" y="133.9263">StartEstimation</text><polygon fill="#A80036" points="70,164.125,60,168.125,70,172.125,66,168.125" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="64" x2="320" y1="168.125" y2="168.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="76" y="163.0591">StartEstimation</text><polygon fill="#A80036" points="332,221.2578,322,225.2578,332,229.2578,328,225.2578" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="326" x2="447" y1="225.2578" y2="225.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="338" y="220.1919">StopEstimation</text><polygon fill="#A80036" points="70,250.3906,60,254.3906,70,258.3906,66,254.3906" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="64" x2="320" y1="254.3906" y2="254.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="76" y="249.3247">StopEstimation</text><path d="M238,304.3906 L376,304.3906 L376,311.3906 L366,321.3906 L238,321.3906 L238,304.3906 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="103.3984" style="stroke: #000000; stroke-width: 2.0;" width="531" x="238" y="304.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="253" y="317.4575">2\3 of epoch</text><polygon fill="#A80036" points="332,338.6563,322,342.6563,332,346.6563,328,342.6563" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="326" x2="447" y1="342.6563" y2="342.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="338" y="337.5903">GetEstimations</text><polygon fill="#A80036" points="680,367.7891,690,371.7891,680,375.7891,684,371.7891" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448" x2="686" y1="371.7891" y2="371.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="455" y="366.7231">Transfer to bank account</text><path d="M394,421.7891 L532,421.7891 L532,428.7891 L522,438.7891 L394,438.7891 L394,421.7891 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="103.3984" style="stroke: #000000; stroke-width: 2.0;" width="375" x="394" y="421.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="409" y="434.856">3\3 of epoch</text><polygon fill="#A80036" points="680,456.0547,690,460.0547,680,464.0547,684,460.0547" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448" x2="686" y1="460.0547" y2="460.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="455" y="454.9888">Get balance of bank account</text><polygon fill="#A80036" points="680,485.1875,690,489.1875,680,493.1875,684,489.1875" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="448" x2="686" y1="489.1875" y2="489.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="455" y="484.1216">Transfer to storage node accounts</text><polygon fill="#A80036" points="182.5,549.3203,172.5,553.3203,182.5,557.3203,178.5,553.3203" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="176.5" x2="447" y1="553.3203" y2="553.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="66" x="188.5" y="548.2544">NewEpoch</text><!--MD5=[522957bc776879eb1ffad4b055e4c7e7]
@startuml
participant "Storage\nnodes" as sn
participant "Netmap contract" as netmap
participant "Container contract" as cnr
participant "Inner Ring\nNodes" as ir
participant "Balance contract" as bln

netmap - -> ir: New epoch notification

group 1\3 of epoch
ir -> cnr: StartEstimation
cnr - -> sn: StartEstimation
...
ir -> cnr: StopEstimation
cnr - -> sn: StopEstimation
...
end

group 2\3 of epoch
ir -> cnr: GetEstimations
ir -> bln: Transfer to bank account
...
end

group 3\3 of epoch
ir -> bln: Get balance of bank account
ir -> bln: Transfer to storage node accounts
...
end

ir -> netmap: NewEpoch

@enduml

PlantUML version 1.2020.15(Sun Jun 28 11:39:45 UTC 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: ANSI_X3.4-1968
Language: en
Country: US
--></g></svg>